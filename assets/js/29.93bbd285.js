(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{454:function(e,t,s){"use strict";s.r(t);var a=s(65),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"阿里云存储oss跨账号迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阿里云存储oss跨账号迁移"}},[e._v("#")]),e._v(" 阿里云存储OSS跨账号迁移")]),e._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[e._v("#")]),e._v(" 背景")]),e._v(" "),s("p",[e._v("某个项目的照片存放在我们公司自己的阿里云存储里，但是，有一天对方需要将数据全部迁移到他们自己那里去，于是我们需要跨账户迁移阿里云存储的某个"),s("code",[e._v("Bucket")]),e._v("全部文件！")]),e._v(" "),s("h2",{attrs:{id:"经过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#经过"}},[e._v("#")]),e._v(" 经过")]),e._v(" "),s("p",[e._v("首先，我注意到了："),s("a",{attrs:{href:"https://help.aliyun.com/document_detail/31861.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("拷贝文件")]),s("OutboundLink")],1),e._v(" "),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e217b44eaada739cf5a34.jpg",alt:""}})]),e._v(" "),s("p",[e._v("因为我们不是用代码迁移，所以下面的"),s("code",[e._v("SDK")]),e._v("什么的先排除，然后，可选的不多了，图形化最简单，但是呢，有大小限制，最大限制为"),s("code",[e._v("5GB")]),e._v("，而我们准备迁移的"),s("code",[e._v("Bucket")]),e._v("有足足"),s("code",[e._v("70GB")]),e._v("，因此，我们选择了"),s("code",[e._v("命令行工具 ossutil")]),e._v("。")]),e._v(" "),s("p",[e._v("下载和安装对应我们当前操作系统的"),s("a",{attrs:{href:"https://help.aliyun.com/document_detail/120075.htm?spm=a2c4g.11186623.0.0.56da7a74aJZg3U#concept-303829",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("ossutil")]),s("OutboundLink")],1),e._v("软件包，并进行相应配置：")]),e._v(" "),s("ol",[s("li",[e._v("单击下载链接下载工具。")]),e._v(" "),s("li",[e._v("将工具解压，并双击运行ossutil.bat文件。")]),e._v(" "),s("li",[e._v("运行以下命令，生成配置文件。")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("D:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("ossutil"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("ossutil64.exe config\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ol",{attrs:{start:"4"}},[s("li",[s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e241e44eaada739d575d0.jpg",alt:""}})])]),e._v(" "),s("p",[e._v("我们按照要求来，进行配置下："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e23e644eaada739d4eeb9.jpg",alt:""}})]),e._v(" "),s("blockquote",[s("p",[e._v("注：")])]),e._v(" "),s("ol",[s("li",[s("p",[s("code",[e._v("endpoint")]),e._v("我们在"),s("a",{attrs:{href:"https://help.aliyun.com/document_detail/31837.htm?spm=a2c4g.11186623.0.0.837e1c34LQy5Hl#concept-zt4-cvy-5db",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("访问域名和数据中心")]),s("OutboundLink")],1),e._v("查看可以看到"),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e247144eaada739d6448b.jpg",alt:""}}),e._v(",需要填入的是 公网地址。")])]),e._v(" "),s("li",[s("p",[e._v("配置的是我们原阿里云存储账户，因为我们是将当前阿里云账户的"),s("code",[e._v("Bucket")]),e._v("拷贝、迁移到另一个最后账户的"),s("code",[e._v("Bucket")]),e._v("里！")])])]),e._v(" "),s("p",[e._v("配置完毕，我们查看下当前阿里云里的所有"),s("code",[e._v("Bucket")]),e._v("：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 列出所有Bucket：")]),e._v("\n./ossutil64 "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("结果很正常的报错了：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'.'")]),e._v(" 不是内部或外部命令，也不是可运行的程序\n或批处理文件。\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("原因很简单，网页上已经写了：")]),e._v(" "),s("blockquote",[s("p",[e._v("本文各命令行示例均基于"),s("code",[e._v("Linux 64位")]),e._v("系统，其他系统请将命令开头的"),s("code",[e._v("./ossutil64")]),e._v("替换成对应的"),s("code",[e._v("Binary名称")]),e._v("。详情请参见"),s("a",{attrs:{href:"https://help.aliyun.com/document_detail/195960.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("命")]),e._v("令行工具ossutil快速入门`"),s("OutboundLink")],1),e._v("。")])]),e._v(" "),s("p",[e._v("于是很明显啦，我们将"),s("code",[e._v("./ossutil64")]),e._v("换成"),s("code",[e._v("ossutil64.exe")]),e._v("即可。")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("ossutil64.exe "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("当前账户下的"),s("code",[e._v("Bucket")]),e._v("列表："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e250c44eaada739d7b5e8.jpg",alt:""}})]),e._v(" "),s("p",[e._v("我们也可以查看下想要迁移的"),s("code",[e._v("Bucket")]),e._v("大小：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("ossutil64.exe "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("du")]),e._v(" oss://Bucket名字 --all-versions\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("blockquote",[s("p",[e._v("这个有点慢，不如控制台查看方便！")])]),e._v(" "),s("p",[e._v("然后，我注意到了"),s("a",{attrs:{href:"https://help.aliyun.com/document_detail/300054.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("sync（同步文件）")]),s("OutboundLink")],1),e._v("这个官网说明，同步文件？")]),e._v(" "),s("blockquote",[s("p",[e._v("sync命令用于同步本地文件到OSS、同步OSS文件到本地、或者在OSS之间同步文件")])]),e._v(" "),s("p",[e._v("有三个选项：")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("有关sync命令用于同步本地文件到OSS的命令格式及使用示例的更多信息，请参见同步本地文件到OSS。")])]),e._v(" "),s("li",[s("p",[e._v("有关sync命令用于同步OSS文件到本地的命令格式及使用示例的更多信息，请参见同步OSS文件到本地。")])]),e._v(" "),s("li",[s("p",[e._v("有关sync命令用于在OSS之间同步文件的命令格式及使用示例的更多信息，请参见"),s("a",{attrs:{href:"https://help.aliyun.com/document_detail/256354.htm?spm=a2c4g.11186623.0.0.2cc7543eWoa9EQ#concept-2080117",target:"_blank",rel:"noopener noreferrer"}},[e._v("在OSS之间同步文件"),s("OutboundLink")],1),e._v("。")])])]),e._v(" "),s("p",[e._v("完美，第三条看起来就是它了，在不同"),s("code",[e._v("OSS")]),e._v("账户之间同步文件嘛，不错不错。")]),e._v(" "),s("p",[e._v("看了一下，发现不大对，咦，咋没看见怎么连接目标的"),s("code",[e._v("Bucket")]),e._v("，这看着不对啊，然后才意识到："),s("code",[e._v("sync（同步文件）")]),e._v("是针对同一个账户下不同"),s("code",[e._v("Bucket")]),e._v("同步用的（当然，也可以阿里云存储和本地之间，但不在我们考虑范围内！）。")]),e._v(" "),s("p",[e._v("这时，最下面的 复制给了我们一线生机：")]),e._v(" "),s("blockquote",[s("p",[e._v("当您需要通过命令行工具ossutil管理不同地域的Bucket时，可以通过-e选项切换至指定Bucket所属的Endpoint。当您需要通过命令行工具ossutil管理多个阿里云账号下的Bucket时，可以通过-i选项切换至指定账号的AccessKey ID，并通过-k选项切换至指定账号的AccessKey Secret。")])]),e._v(" "),s("blockquote",[s("p",[e._v("例如，您需要将另一个阿里云账号下，华东2（上海）地域下源存储空间examplebucket的文件夹srcfolder同步至目标存储空间testbucket的文件夹examplefolder，命令如下：")])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./ossutil64 "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v(" oss://examplebucket/srcfolder/  oss://testbucket/examplefolder/ -e oss-cn-shanghai.aliyuncs.com -i LTAI4Fw2NbDUCV8zYUzA  -k 67DLVBkH7EamOjy2W5RVAHUY9H\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("说的稍微抽象了一点，意思就是很简单：")]),e._v(" "),s("ul",[s("li",[e._v("要将一个云存储里的东西拷贝到另一个地方，需要指定 源目录 和 目标目录，然后如果不是在一个地域的"),s("code",[e._v("Bucket")]),e._v("也要用"),s("code",[e._v("-e")]),e._v("参数指定下目标"),s("code",[e._v("Bucket")]),e._v("所在地域对应的"),s("code",[e._v("外网Endpoint")])]),e._v(" "),s("li",[e._v("如果是跨账号，需要通过"),s("code",[e._v("-i")]),e._v("指定阿里云的"),s("code",[e._v("AccessKey ID")]),e._v("，"),s("code",[e._v("-k")]),e._v("指定"),s("code",[e._v("AccessKey Secret")])])]),e._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://help.aliyun.com/document_detail/50455.htm?spm=a2c4g.11186623.0.0.39b91bdb2n4ppu#section-yhn-ko6-gqj",target:"_blank",rel:"noopener noreferrer"}},[e._v("命令的相关选项解释"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("但是，这个也有个限制，我不确定文件大小有没有超过这个范围："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2d1744eaada739eb3b53.jpg",alt:""}})]),e._v(" "),s("p",[e._v("于是，我们使用了"),s("code",[e._v("cp")]),e._v("这个命令：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 直接拷贝bucket下面的所有东西")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -r代表递归拷贝，包括子目录和子文件")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -j代表多少个任务")]),e._v("\nossutil64.exe "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" oss://examplebucket  oss://testbucket -e oss-cn-shanghai.aliyuncs.com -i LTAI4Fw2NbDUCV8zYUzA  -k 67DLVBkH7EamOjy2W5RVAHUY9H -r -j "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("之所以使用"),s("code",[e._v("100")]),e._v("是因为按它上面的说明我不确定我们公司服务器算不算大："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2db044eaada739eca8ed.jpg",alt:""}})]),e._v(" "),s("p",[e._v("当然，你也可能会碰见些许问题：")]),e._v(" "),s("ol",[s("li",[e._v("权限不够："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2e4944eaada739ee1c49.jpg",alt:""}})])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("average speed "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("byte/s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nError: oss: "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" returned error: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("StatusCode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("403")]),e._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ErrorCode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("AccessDenied, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ErrorMessage")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"The bucket you access does not belong to you."')]),e._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("RequestId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("XXXXXXXXXXXX, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("Bucket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Bucket名字, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("Object")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("解决思路：")]),e._v(" "),s("ul",[s("li",[e._v("在源"),s("code",[e._v("Bucket")]),e._v("和目标"),s("code",[e._v("Bucket")]),e._v("里都设置授权用户："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2ed344eaada739ef7f89.jpg",alt:""}}),e._v("、"),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2f6044eaada739f177c7.jpg",alt:""}}),e._v("、"),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2f2044eaada739f08db9.jpg",alt:""}})])]),e._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[e._v("进度特别慢，我这里"),s("code",[e._v("100G")]),e._v("大概得拷贝"),s("code",[e._v("14")]),e._v("个小时，所以也许你觉得服务器还OK的情况下可以试着把"),s("code",[e._v("job")]),e._v("增加！")])]),e._v(" "),s("h2",{attrs:{id:"舍弃方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#舍弃方案"}},[e._v("#")]),e._v(" 舍弃方案")]),e._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://help.aliyun.com/document_detail/31864.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("跨区域复制介绍"),s("OutboundLink")],1)])]),e._v(" "),s("ul",[s("li",[e._v("舍弃原因：太长，不讲人话！")])]),e._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("a",{attrs:{href:"https://help.aliyun.com/document_detail/99079.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("OSS 之间数据迁移"),s("OutboundLink")],1)])]),e._v(" "),s("ul",[s("li",[e._v("舍弃原因：虽然这个是网页操作，看起来也很符合"),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2c3844eaada739e9087e.jpg",alt:""}}),e._v("，但是，有个坑爹的地方，需要申请填写工单，很麻烦而且不能立即解决问题："),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2c7244eaada739e99efe.jpg",alt:""}}),s("img",{attrs:{src:"https://pic.imgdb.cn/item/612e2c9944eaada739ea00bb.jpg",alt:""}})])])])}),[],!1,null,null,null);t.default=r.exports}}]);